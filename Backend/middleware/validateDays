const jwt = require('express-jwt');
const { secret } = require('config.json');
const {models} = require('./../libs/sequelize');
const { AvailableDays } = require('../db/models/availableDays.model');
const { Employee } = require('../db/models/employee.model');
const moment = require('moment-timezone');

module.exports = validateDays;

function validateDays() {
    return [
        // attach full user record to request object
        async (req, res, next) => {
  
            //verificamos que tenga registro de fecha de ingreso
            const employee=await models.Employee.findOne({where:{id:req.params.id}});
            
            if(!employee.fechaIngreso){return res.status(404).json({message: "El empleado no tiene fecha de ingreso"})}
            
            // verificamos que exista registro de dias
            const avaibleDays=await models.AvailableDays.findOne(({where:{employeeId:employee.id}}));

            if(!avaibleDays){
                // return res.status(404).json({message: "El empleado no tiene REGISTRO"})
                //comparamos las fechas
                // const fechaActual = moment().tz(process.env.TZ).format(['YYYYMMDD']);
                // const fechaIngreso=moment(employee.fechaIngreso).format(['YYYYMMDD']);
                // const anoActual=moment(employee.fechaIngreso).format(['YYYY']);
                // var fechaActual = moment([2022, 0, 03]);
                // var fechaIngreso = moment([2011, 0, 03]);
                var fechaActual = moment().tz(process.env.TZ);
                var fechaIngreso = moment(employee.fechaIngreso);
                let diff=fechaActual.diff(fechaIngreso, 'years') 
                
                console.log(diff);    
                // console.log(employee);
            }
            
            next();
        }
    ];
}